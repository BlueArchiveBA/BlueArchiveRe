<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="description" content="ë¦¬ì„¸íŒ©í† ë¦¬ : ë¸”ë£¨ì•„ì¹´ì´ë¸Œ">
<meta name="keywords" content="ë¦¬ì„¸íŒ©í† ë¦¬, ë¸”ë£¨ì•„ì¹´ì´ë¸Œ, ë¸”ë£¨ì•„ì¹´, ë¸”ë£¨ ì•„ì¹´ì´ë¸Œ, ë¸”ë£¨ ì•„ì¹´, ë¦¬ì„¸ê³„, ê³„ì •, ë¸”ë£¨ ì•„ì¹´ì´ë¸Œ ê³„ì •, ë¸”ë£¨ ì•„ì¹´ ê³„ì •, ë¦¬ì„¸ë§ˆë¼, ë¦¬ì„¸ê³„ì •, ë¦¬ì„¸ ê³„ì •, í•œì„¯, í•œêµ­ì„œë²„, ë¸”ë£¨ì•„ì¹´ì±„ë„, ë¸”ë£¨ì•„ì¹´ê°¤, ë¸”ë£¨ì•„ì¹´ì±ˆ, ë¸”ë£¨ì•„ì¹´ë¦¬ì„¸, ë¸”ë£¨ì•„ì¹´ë¦¬ì„¸ê³„, ëª°ë£¨ ë¦¬ì„¸, ëª°ë£¨ ë¦¬ì„¸ê³„, ë¸”ë£¨ì•„ì¹´ ë¦¬ì„¸, ë¸”ë£¨ì•„ì¹´ì´ë¸Œ ë¦¬ì„¸, ëª°ë£¨ ë¦¬ì„¸, ë¸”ë£¨ì•„ì¹´ì´ë¸Œ ì±„ë„, ë¸”ë£¨ì•„ì¹´ì±ˆ, ë¸”ë£¨ì•„ì¹´ì´ë¸Œì±ˆ, ë¸”ë£¨ì•„ì¹´ì±„ë„, ë¸”ë£¨ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬, ë¸”ë£¨ì•„ì¹´ê°¤, ë¸”ë£¨ì•„ì¹´ê°¤ëŸ¬ë¦¬, ë¸”ë£¨ì•„ì¹´ì´ë¸Œê°¤">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" sizes="48x48" href="/static/images/favicon.png">
<title>ë¦¬ì„¸íŒ©í† ë¦¬ : ë¸”ë£¨ì•„ì¹´ì´ë¸Œ</title>
<style>
body {
    font-family: 'Pretendard', sans-serif;
    background: #e8f4ff;
    text-align: center;
    margin: 20px;
}

#header-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: transparent;
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    padding: 10px;
    flex-wrap: nowrap;
    flex-direction: row;
}

#chatButton {
    padding: 10px 20px;
    background-color: #FFEB00;
    color: #000;
    font-weight: bold;
    border-radius: 8px;
    text-decoration: none;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    font-size: 15px;
}

.update-date {
    font-size: 14px;
    color: red;
    background: #fff7f7;
    padding: 6px 10px;
    border: 1px solid #ffcccc;
    border-radius: 6px;
    font-weight: bold;
}

.intro {
    margin-top: 80px;
    font-size: 17px;
    line-height: 1.6;
    color: #333;
}

#selected-info {
    margin-bottom: 15px;
}

#selected-list img {
    width: 40px;
    height: 40px;
    margin: 3px;
    border-radius: 5px;
    border: 2px solid #aaa;
}

#spinner {
    display: none;
    margin-top: 20px;
    font-size: 18px;
    color: #555;
}

#result {
    max-width: 1400px;
    margin: 30px auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.account-card {
    width: 100%;
    background: #fff;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.account-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    font-size: 16px;
    justify-content: flex-start;
}

.copy-btn {
    padding: 5px 10px;
    background: #4caf50;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

.account-price {
    font-weight: bold;
    color: #1b85db;
    margin-left: 10px;
}

.character-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: flex-start;
}

.result-character-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 60px;
}

.result-character-card img {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    border: 3px solid gray;
}

#pagination {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin: 10px auto;
}

.page-btn {
    padding: 6px 10px;
    background-color: #eee;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
}

.page-btn.active {
    background-color: #1b85db;
    color: white;
}

.page-dots {
    padding: 6px 10px;
    background-color: transparent;
    border: none;
    cursor: default;
    font-size: 16px;
    color: #999;
}

#summary {
    font-size: 16px;
    font-weight: bold;
    margin-top: 15px;
}

#characters {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 20px;
    align-items: center;
}

.character-row {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 15px;
    justify-content: center;
}

.character-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 80px;
    padding: 4px;
    border-radius: 10px;
    background: #f9f9f9;
    transition: all 0.3s ease;
}

.character-card img {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    border: 3px solid gray;
    transition: all 0.3s ease;
    cursor: pointer;
}

.character-card:hover {
    transform: scale(1.05);
    background: #eef7ff;
}

.character-card:hover img {
    border-color: #3399ff;
}

.character-name {
    margin-top: 5px;
    font-size: 14px;
    font-weight: bold;
    color: #333;
}

.character-feature {
    font-size: 12px;
    color: #ff5656;
}

.character-card.selected {
    background: #cfe9ff;
}

.character-card img.selected {
    border-color: green;
}

.main-notice {
  max-width: 820px;
  margin: 18px auto 10px;
  padding: 12px 14px;
  background: #fff6f6;
  border: 1px solid #ffd1d1;
  border-radius: 12px;
  font-size: 14px;
  line-height: 1.5;
  color: #333;
}
.main-notice strong {
  color: #d60000;
}
.main-notice a {
  color: #1b85db;
  font-weight: 600;
  text-decoration: underline;
}

.update-notice {
  max-width: 820px;
  margin: 10px auto 0;
  padding: 12px 14px;
  background: #f3fff8;
  border: 1px solid #beffe4;
  border-radius: 12px;
  font-size: 14px;
  line-height: 1.5;
  color: #234;
}
.update-notice strong {
  color: #1b85db;
}
.update-notice .tag {
  display: inline-block;
  margin-right: 6px;
  padding: 2px 8px;
  border-radius: 999px;
  background: rgba(27,133,219,0.12);
  color: #1b85db;
  font-weight: 700;
  font-size: 12px;
}

/* ëª¨ë°”ì¼ ëŒ€ì‘ */
@media (max-width: 768px) {
  body {
    margin: 10px;
  }

  #header-bar {
    flex-direction: column;
    align-items: center;
    gap: 5px;
  }

  .update-date {
    order: 0;
    font-size: 13px;
    padding: 4px 6px;
    text-align: center;
  }

  #chatButton {
    order: 1;
    font-size: 14px;
    padding: 10px 20px;
  }

  #characters {
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
  }

  .character-card {
    width: 70px;
    padding: 2px;
  }

  .character-card img {
    width: 52px;
    height: 52px;
  }

  .character-name {
    font-size: 12px;
  }

  .character-feature {
    font-size: 11px;
  }

  .account-card {
    padding: 10px;
  }

  .result-character-card {
    width: 52px;
  }

  .result-character-card img {
    width: 52px;
    height: 52px;
  }

  .intro {
    font-size: 15px;
    margin-top: 30px;
  }
}

#quick-nav {
  margin: 30px auto 10px;
  display: flex;
  gap: 14px;
  justify-content: center;
  flex-wrap: wrap;
  max-width: 560px;
}

.quick-btn {
  flex: 1 1 200px;
  padding: 12px 18px;
  background-color: #ffffff;
  color: #1b85db;
  font-weight: 600;
  border-radius: 10px;
  text-decoration: none;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.12);
  font-size: 16px;
  transition: background 0.2s ease;
}

.quick-btn:hover { background-color: #f0f8ff; }

@media (max-width: 600px) {
  .quick-btn {
    flex: 1 1 100%;
    font-size: 15px;
  }
}

</style>
</head>
<body>

<div id="header-bar">
    <div class="update-date">ğŸ“… ëª©ë¡ ì—…ë°ì´íŠ¸ : 2025ë…„ 12ì›” 23ì¼</div>
    <a href="https://open.kakao.com/o/sUiS9iEe" target="_blank" id="chatButton">ğŸ›‹ 1:1 ìƒë‹´ ë°”ë¡œê°€ê¸°</a>
</div>
      
<main style="margin-top: 100px;"></main>

<h1 class="page-title">
    ë¦¬ì„¸íŒ©í† ë¦¬
</h1>

<h2 class="page-title">
    ë¸”ë£¨ì•„ì¹´ì´ë¸Œ í•œêµ­ì„œë²„ ë¦¬ì„¸ê³„ì •&nbsp;íŒë§¤
</h2>

<div style="display:flex; justify-content:center; align-items:center; margin-top:24px; margin-bottom:20px;">
    <img src="/static/images/ì¿ í°.png" alt="Blue Archive Illustration" style="max-width:660px; width:95vw; border-radius:18px; box-shadow:0 6px 32px rgba(0,0,0,0.08);" />
</div>

<div class="intro">
    ì•ˆë…•í•˜ì„¸ìš”!<br>
    ë¸”ë£¨ì•„ì¹´ì´ë¸Œ <strong>í•œêµ­ì„œë²„</strong> ë¦¬ì„¸ê³„ë¥¼ íŒë§¤í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>
    ì§ì ‘ ë§Œë“¤ì–´ ì¶œì„ì²´í¬, ë½‘ê¸°, 1-1ì†Œíƒ•ì„ ì§„í–‰í•œ <strong>êµ­ì‚°ê³„ì •</strong>ì…ë‹ˆë‹¤.<br>
    ìºë¦­íšë“ìˆœì„œ, ê°€ì´ë“œë¯¸ì…˜, 1-1í´ë¦¬ì–´, ì´ë²¤íŠ¸ë‹¤ì‹œë³´ê¸° <strong>ëª¨ë“  ì¸ì¦ ê°€ëŠ¥</strong>í•©ë‹ˆë‹¤!<br>
    ìƒë‹´ì€ <strong>ì˜¤í”ˆì¹´í†¡</strong>ìœ¼ë¡œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.<br><br>
    <strong style="color:rgb(255, 145, 0);">â€» ê³„ì •êµ¬ë§¤ ì‹œ ì¿ í° ë°œê¸‰ ì´ë²¤íŠ¸ ì§„í–‰ì¤‘! (êµ¬ë§¤ê¸ˆì•¡ì˜ 15% ìƒë‹¹)</strong><br><br>
    <strong style="color:red;">â€» ëŠ¦ì€ ë°¤ì´ë‚˜ ìƒˆë²½ì‹œê°„ëŒ€ ë‹µë³€ì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ì–´ë‚˜ëŠ” ì¦‰ì‹œ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</strong>
    <div class="main-notice">
        âš ï¸ <strong>[ì¤‘ìš”]</strong> ê³„ì • ì—°ë™ ì „ <strong>ì ˆëŒ€ ë¡œê·¸ì¸í•˜ì§€ ë§ˆì„¸ìš”.</strong><br>
        ìµœì´ˆ ì ‘ì† ì‹œ ìë™ ì—°ë™ë˜ì–´ ì´í›„ ì—°ë™ì´ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        ìì„¸í•œ ë‚´ìš©ì€ <a href="/guide/trade.html" target="_blank">ê±°ë˜ ê°€ì´ë“œ</a>ë¥¼ ì°¸ê³ í•´ ì£¼ì„¸ìš”.
    </div>
    <div class="update-notice">
        <span class="tag">ğŸ“Œ í˜ìŠ¤ ì—…ë°ì´íŠ¸ (12.23 ~ 26)</span><br>
        <strong>í˜ìŠ¤ ë½‘ê¸° ì§„í–‰ ì¤‘ (ìˆ˜ë¯¸ì¹´Â·ìˆ˜ë‚˜ê¸°Â·ë“œíˆë‚˜)</strong><br>
        ê³„ì • ëª©ë¡ì€ <strong>ìˆœì°¨ì ìœ¼ë¡œ ê°±ì‹ </strong>ë©ë‹ˆë‹¤.
    </div>          
</div>

<div id="quick-nav">
    <a href="/guide/trade.html" target="_blank" rel="noopener" class="quick-btn">
      ğŸ’¡ ê±°ë˜ ê°€ì´ë“œ
    </a>
    <a href="/guide/faq.html"  target="_blank" rel="noopener" class="quick-btn">
      â“ FAQ
    </a>
    <a href="/guide/coupon-guide.html"  target="_blank" rel="noopener" class="quick-btn">
      ğŸ ì¿ í° ê°€ì´ë“œ
    </a>
</div>  

<h2>í•™ìƒ ì„ íƒ í›„ ê³„ì • ì°¾ê¸°</h2>

<div id="characters"></div>

<div style="margin:12px 0;">
    <button id="detailSearchBtn" style="background:#adadad; color:white; padding:7px 28px; border:none; border-radius:8px; font-size:18px;">ê¸°íƒ€í•™ìƒë³´ê¸°</button>
</div>

<div id="selected-info">
    ì„ íƒí•œ í•™ìƒ: <span id="selected-count">0</span>ê°œ
    <button onclick="clearSelection()" style="margin-left:10px;">ì„ íƒ ì´ˆê¸°í™”</button>
</div>
<div id="selected-list"></div>

<div style="margin:20px 0;">
    <strong style="color:red;">ê°€ê²©:
    <input id="minPrice" type="number" min="1" max="99" value="1" style="width:60px;"> ~
    <input id="maxPrice" type="number" min="1" max="99" value="99" style="width:60px;"> ë§Œì›</strong>
</div>

<div style="margin:10px 0;">
    ì •ë ¬ìˆœì„œ:
    <select id="sortOrder" style="margin-left:10px;">
      <option value="desc">ê°€ê²© ë†’ì€ìˆœ</option>
      <option value="asc">ê°€ê²© ë‚®ì€ìˆœ</option>
    </select>
</div>

<div style="margin-bottom:18px;">
    <button onclick="searchAccounts()" style="background:#1b85db; color:white; padding:7px 28px; border:none; border-radius:8px; font-size:18px; font-weight: bold;">ğŸ” ê³„ì •ì°¾ê¸°</button>
</div>
  
<div id="spinner">ğŸ”„ ë¡œë”© ì¤‘...</div>

<div id="detailModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,40,60,0.18); z-index:20000; justify-content:center; align-items:flex-start;">
    <div style="background:#fff; border-radius:14px; max-width:900px; width:96vw; margin:70px auto 0; padding:30px 20px 18px; box-shadow:0 6px 40px rgba(0,0,0,0.16); position:relative;">
      <button onclick="closeDetailModal()" style="position:absolute; right:16px; top:13px; font-size:20px; background:none; border:none; cursor:pointer;">Ã—</button>
      <h3 style="font-size:19px; margin:0 0 15px 0; color:#1b85db; font-weight:800;">ê¸°íƒ€ í•™ìƒ ìƒì„¸ê²€ìƒ‰</h3>      
      <div style="max-height:54vh; overflow-y:auto; margin-bottom:22px;">
        <div id="detailCharWrap" style="margin:14px 0 10px 0; display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-start;"></div>
        <div id="otherCharWrap" style="margin:16px 0 5px 0; display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-start;"></div>
      </div>
      <div style="width:100%; text-align:center; position:sticky; bottom:0; background:#fff; padding-top:8px; padding-bottom:2px;">
        <button onclick="closeDetailModal()" style="background:#1b85db; color:white; padding:8px 36px; border:none; border-radius:8px; font-size:16px; font-weight:bold;">ì„ íƒ ì™„ë£Œ</button>
      </div>
    </div>
</div>
    

<div id="summary"></div>
<div id="result"></div>
<div id="pagination"></div>

<div id="accountModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,40,60,0.44); z-index:99999; justify-content:center; align-items:center;">
    <div style="background:#fff; border-radius:18px; max-width:900px; width:96vw; padding:26px 18px 16px; box-shadow:0 6px 40px rgba(0,0,0,0.2); position:relative;">
      <button onclick="closeAccountModal()" style="position:absolute; right:14px; top:14px; font-size:20px; background:none; border:none; cursor:pointer;">Ã—</button>
      <div style="display:flex; align-items:center; gap:12px; margin-bottom:14px;">
        <h3 style="margin:0; font-size:20px; color:#1b85db; font-weight:800;" id="modalAccountNum">ê³„ì • ìƒì„¸</h3>
        <span style="color:#1b85db; font-size:16px; font-weight:700;" id="modalAccountPrice"></span>
        <span id="modalAccountCount" style="margin-left:8px; color:#34495e; font-size:15px; font-weight:600;"></span>
        <button id="modalCopyBtn" class="copy-btn" style="padding:4px 10px; margin-left:auto;">ë³µì‚¬</button>
      </div>
      <div id="modalAccountChars"
        style="display:flex; flex-wrap:wrap; gap:13px; justify-content:center; align-items:flex-start; margin-top:6px; max-height:54vh; overflow-y:auto;">
      </div>
    </div>
</div>
  

<script>

let currentPage = 1;
const pageSize = 20;
let currentFilteredAccounts = [];

window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);    
    drawCharacters();
    searchAccounts(false);
};

const characterData = [
            { name: 'ìˆ˜ì‹œë…¸', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ë¯¸ì¹´', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ìˆ˜ë‚˜ì½”', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ë“œíˆë‚˜', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ì„ì‹œë…¸', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ì¿ ë¡œì½”', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ë¦¬ì˜¤', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'êµë„¤ë£¨', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ìˆ˜ë¯¸ì¹´', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'ìˆ˜ë‚˜ê¸°', grade: '0í‹°ì–´', feature: 'FES' },
            { name: 'í‚¤ì‚¬í‚¤', grade: '0í‹°ì–´', feature: '' },
            { name: 'ìˆ˜ë¡œì½”', grade: '0í‹°ì–´', feature: '' },
            { name: 'ì™€ì¹´ëª¨', grade: '0.5í‹°ì–´', feature: 'FES' },
            { name: 'ë‰´ìš°ì¹´', grade: '0.5í‹°ì–´', feature: 'í•œì •' },
            { name: 'ì•„ë§ˆë¦¬', grade: '0.5í‹°ì–´', feature: 'í•œì •' },
            { name: 'ì„¸ì´ì•„', grade: '0.5í‹°ì–´', feature: 'í•œì •' },
            { name: 'ìˆ˜ì´ì•„', grade: '0.5í‹°ì–´', feature: 'í•œì •' },
            { name: 'ìº í•˜ë ˆ', grade: '0.5í‹°ì–´', feature: '' },
            { name: 'ë“œì•„ë£¨', grade: '0.5í‹°ì–´', feature: '' },
            { name: 'ì½”ì½”ë‚˜', grade: '0.5í‹°ì–´', feature: '' },
            { name: 'ìš´ìœ ì¹´', grade: '1í‹°ì–´', feature: 'í•œì •' },
            { name: 'íˆì¹´ë¦¬', grade: '1í‹°ì–´', feature: 'í•œì •' },
            { name: 'ë…¸ì¡°ë¯¸', grade: '1í‹°ì–´', feature: 'í•œì •' },
            { name: 'ë‚˜ê¸°ì‚¬', grade: '1í‹°ì–´', feature: 'í•œì •' },
            { name: 'ë‰´ì¸ í‚¤', grade: '1í‹°ì–´', feature: 'í•œì •' },          
            { name: 'ì•„ì½”', grade: '1í‹°ì–´', feature: '' },
            { name: 'íˆë§ˆë¦¬', grade: '1í‹°ì–´', feature: '' },
            { name: 'ë‰´ìš”ì½”', grade: '1í‹°ì–´', feature: '' },
            { name: 'ìš°ì´', grade: '1í‹°ì–´', feature: '' },
            { name: 'ìŠŒ', grade: '1í‹°ì–´', feature: '' },
            { name: 'ì²´ë¦¬ë…¸', grade: '1í‹°ì–´', feature: '' },
            { name: 'íˆë‚˜íƒ€', grade: '1í‹°ì–´', feature: '' },
            { name: 'ìˆ˜ì¦ˆë‚˜', grade: '2í‹°ì–´', feature: 'í•œì •' },
            { name: 'ë‰´ë£¨ë‚˜', grade: '2í‹°ì–´', feature: 'í•œì •' },
            { name: 'ë“œì•„ì½”', grade: '2í‹°ì–´', feature: 'í•œì •' },
            { name: 'ìˆ˜ìš°ì´', grade: '2í‹°ì–´', feature: 'í•œì •' },
            { name: 'ìˆ˜ìš”ë¦¬', grade: '2í‹°ì–´', feature: 'í•œì •' },
];

const gradeBorderColors = {
  "0í‹°ì–´": "rgb(255, 0, 255)",
  "0.5í‹°ì–´": "rgb(255, 0, 0)",
  "1í‹°ì–´": "rgb(255, 153, 0)",
  "2í‹°ì–´": "rgb(153, 0, 255)"
};

const accounts = [
];

let selectedChars = [];

function toggleCharacter(charName, imgElement, wrapperElement) {
    if (selectedChars.includes(charName)) {
        selectedChars = selectedChars.filter(c => c !== charName);
        imgElement.classList.remove('selected');
        wrapperElement.classList.remove('selected');
    } else {
        selectedChars.push(charName);
        imgElement.classList.add('selected');
        wrapperElement.classList.add('selected');
    }
    updateSelectedInfo();
}

function updateSelectedInfo() {
    document.getElementById('selected-count').innerText = selectedChars.length;
    const selectedList = document.getElementById('selected-list');
    selectedList.innerHTML = '';
    selectedChars.forEach(name => {
        const img = document.createElement('img');
        img.src = `/static/images/${name}.png`;
        img.title = name;
        img.onclick = function () {
            removeSelectedCharacter(name);
        };

        selectedList.appendChild(img);
    });
}

function clearSelection() {
    selectedChars = [];
    drawCharacters();
    updateSelectedInfo();
}

function drawCharacters() {
    const tierColors = {
      '0í‹°ì–´': 'rgb(255, 0, 255)',
      '0.5í‹°ì–´': 'rgb(255, 0, 0)',
      '1í‹°ì–´': 'rgb(255, 153, 0)',
      '2í‹°ì–´': 'rgb(153, 0, 255)'
    };
    const charactersDiv = document.getElementById('characters');
    charactersDiv.innerHTML = '';

    const grouped = {};
    characterData.forEach(c => {
        if (!grouped[c.grade]) grouped[c.grade] = [];
        grouped[c.grade].push(c);
    });

    const sortedTiers = Object.keys(grouped).sort((a, b) => {
        const parseTier = s => parseFloat(s.replace('í‹°ì–´', '')) || 0;
        return parseTier(a) - parseTier(b);
    });

    sortedTiers.forEach(tier => {
        const section = document.createElement('div');
        section.style.marginBottom = '0px';

        const title = document.createElement('div');
        title.innerText = tier;
        title.style.fontSize = '20px';
        title.style.fontWeight = 'bold';
        title.style.textAlign = 'left';
        title.style.margin = '10px 0 5px 10px';
        title.style.color = tierColors[tier] || '#000'; // ê¸€ììƒ‰
        title.style.borderLeft = `6px solid ${tierColors[tier] || '#000'}`; // ì™¼ìª½ í…Œë‘ë¦¬ ê°•ì¡°
        title.style.paddingLeft = '8px';

        


        const grid = document.createElement('div');
        grid.style.display = 'flex';
        grid.style.flexWrap = 'wrap';
        grid.style.gap = '10px';
        grid.style.justifyContent = 'center';

        grouped[tier].forEach(c => {
            const wrapper = document.createElement('div');
            wrapper.className = 'character-card';

            const img = document.createElement('img');
            img.src = `/static/images/${c.name}.png`;
            img.style.borderColor = gradeBorderColors[c.grade] || 'gray';
            img.onclick = function() {
                toggleCharacter(c.name, img, wrapper);
            };

            const nameDiv = document.createElement('div');
            nameDiv.className = 'character-name';
            nameDiv.innerText = c.name;

            const featureDiv = document.createElement('div');
            featureDiv.className = 'character-feature';
            featureDiv.innerText = c.feature;

            wrapper.appendChild(img);
            wrapper.appendChild(nameDiv);
            wrapper.appendChild(featureDiv);
            grid.appendChild(wrapper);
        });

        section.appendChild(title);
        section.appendChild(grid);
        charactersDiv.appendChild(section);
    });    
}

function renderAccounts(accountsArray) {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';

    const summaryDiv = document.getElementById('summary');
    const totalPage = Math.ceil(accountsArray.length / pageSize);
    summaryDiv.innerText = `${accountsArray.length}ê°œì˜ ê³„ì •ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤ (í˜„ì¬ ${currentPage} í˜ì´ì§€, ì´ ${totalPage} í˜ì´ì§€)`;

    const start = (currentPage - 1) * pageSize;
    const pageAccounts = accountsArray.slice(start, start + pageSize);

    pageAccounts.forEach(acc => {
        const accBox = document.createElement('div');
        accBox.className = 'account-card';

        accBox.innerHTML = `<div class="account-header">
            <button class="copy-btn" onclick="copyAccount('${acc.num}')">ë³µì‚¬</button>
            <span class="account-num">${acc.num}</span>
            <span class="account-price">ê°€ê²©: ${acc.price}ë§Œ</span>
            <span style="margin-left:15px; color:#34495e; font-size:15px; font-weight:600;">ì´ í•™ìƒ ${acc.chars.length}ëª…</span>
            <button class="copy-btn" style="background:#34495e; margin-left:auto;" onclick="openAccountModal('${acc.num}')">ìƒì„¸ë³´ê¸°</button>
        </div>`;

        const charGrid = document.createElement('div');
        charGrid.className = 'character-list';

        const tierCharacterNames = characterData.map(c => c.name);
        const uniqueChars = [...new Set(acc.chars)];
        const filteredChars = uniqueChars.filter(
          name => tierCharacterNames.includes(name) || selectedChars.includes(name)
        );
        const sortedChars = sortCharactersByPriority(filteredChars);

        sortedChars.forEach(name => {
            const wrapper = document.createElement('div');
            wrapper.className = 'result-character-card';

            const img = document.createElement('img');
            img.src = `/static/images/${name}.png`;
            img.style.border = `3px solid ${gradeBorderColors[getGradeByName(name)] || 'gray'}`;

            if (selectedChars.includes(name)) {
                wrapper.style.backgroundColor = '#cfe9ff';
            }

            const nameDiv = document.createElement('div');
            nameDiv.className = 'character-name';
            nameDiv.innerText = name;

            const featureDiv = document.createElement('div');
            featureDiv.className = 'character-feature';
            featureDiv.innerText = getFeatureByName(name);

            wrapper.appendChild(img);
            wrapper.appendChild(nameDiv);
            wrapper.appendChild(featureDiv);
            charGrid.appendChild(wrapper);
        });

        accBox.appendChild(charGrid);
        resultDiv.appendChild(accBox);
    });

    const paginationDiv = document.getElementById('pagination');
    paginationDiv.innerHTML = '';
    for (let i = 1; i <= totalPage; i++) {
        const btn = document.createElement('button');
        btn.className = 'page-btn' + (i === currentPage ? ' active' : '');
        btn.innerText = i;
        btn.onclick = () => {
            currentPage = i;
            renderAccounts(currentFilteredAccounts);
            window.scrollTo({ top: document.getElementById('characters').offsetTop, behavior: 'smooth' });
        };
        paginationDiv.appendChild(btn);
    }

    renderPagination(totalPage);
}

function searchAccounts(scrollToResult = true) {
    const minPrice = parseFloat(document.getElementById('minPrice').value);
    const maxPrice = parseFloat(document.getElementById('maxPrice').value);

    document.getElementById('spinner').style.display = 'block';

    setTimeout(() => {
        document.getElementById('spinner').style.display = 'none';

        const sortOrder = document.getElementById('sortOrder').value;

        const filteredAccounts = accounts
            .filter(acc => {
                const priceValid = acc.price >= minPrice && acc.price <= maxPrice;
                const charsValid = selectedChars.every(sc => acc.chars.includes(sc));
                return priceValid && charsValid;
            })
            .sort((a, b) => {
                return sortOrder === 'asc' ? a.price - b.price : b.price - a.price;
            });

        if (filteredAccounts.length === 0) {
            alert('ì¡°ê±´ì— ë§ëŠ” ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        currentPage = 1;
        currentFilteredAccounts = filteredAccounts;
        renderAccounts(filteredAccounts);
        if (scrollToResult) {
            window.scrollTo({ top: document.getElementById('summary').offsetTop, behavior: 'smooth' });
        }

    }, 300);
}

function copyAccount(accountNum) {
    const acc = currentFilteredAccounts.find(a => a.num === accountNum);
    const copyText = acc ? `${acc.num} (${acc.price}ë§Œ)` : accountNum;
    navigator.clipboard.writeText(copyText)
        .then(() => alert('ê³„ì •ë²ˆí˜¸ ë³µì‚¬ ì™„ë£Œ!'));
}


// â˜…â˜…â˜… í•™ìƒ ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ â˜…â˜…â˜…
const priorityList = [
  'ìˆ˜ì‹œë…¸', 'ë¯¸ì¹´', 'ìˆ˜ë‚˜ì½”', 'ë“œíˆë‚˜', 'ì„ì‹œë…¸', 'ì¿ ë¡œì½”', 'ë¦¬ì˜¤', 'êµë„¤ë£¨', 'ìˆ˜ë¯¸ì¹´', 'ìˆ˜ë‚˜ê¸°', 'í‚¤ì‚¬í‚¤', 'ìˆ˜ë¡œì½”',
  'ì™€ì¹´ëª¨', 'ë‰´ìš°ì¹´', 'ì•„ë§ˆë¦¬', 'ì„¸ì´ì•„', 'ìˆ˜ì´ì•„', 'ìº í•˜ë ˆ', 'ë“œì•„ë£¨', 'ì½”ì½”ë‚˜',
  'ìš´ìœ ì¹´','íˆì¹´ë¦¬','ë…¸ì¡°ë¯¸','ë‚˜ê¸°ì‚¬','ë‰´ì¸ í‚¤','ì•„ì½”','íˆë§ˆë¦¬','ë‰´ìš”ì½”','ìš°ì´','ìŠŒ','ì²´ë¦¬ë…¸','íˆë‚˜íƒ€',
  'ìˆ˜ì¦ˆë‚˜', 'ë‰´ë£¨ë‚˜', 'ë“œì•„ì½”', 'ìˆ˜ìš°ì´', 'ìˆ˜ìš”ë¦¬'
];

// â˜…â˜…â˜… ê³„ì • ë°ì´í„° ì •ë ¬ í•¨ìˆ˜ ì¶”ê°€ â˜…â˜…â˜…
function sortCharactersByPriority(chars) {
  const priorityMap = {};
  priorityList.forEach((name, idx) => {
    priorityMap[name] = idx;
  });
  return chars.slice().sort((a, b) => {
    return (priorityMap[a] ?? 999) - (priorityMap[b] ?? 999);
  });
}

function getGradeByName(name) {
    const char = characterData.find(c => c.name === name);
    return char ? char.grade : 'ì¼ë°˜';
}

function getFeatureByName(name) {
    const char = characterData.find(c => c.name === name);
    return char ? char.feature : '';
}

function sortCharactersByPriority(chars) {
    const priorityList = [
        'ìˆ˜ì‹œë…¸', 'ë¯¸ì¹´', 'ìˆ˜ë‚˜ì½”', 'ë“œíˆë‚˜', 'ì„ì‹œë…¸', 'ì¿ ë¡œì½”', 'ë¦¬ì˜¤', 'êµë„¤ë£¨', 'ìˆ˜ë¯¸ì¹´', 'ìˆ˜ë‚˜ê¸°', 'í‚¤ì‚¬í‚¤', 'ìˆ˜ë¡œì½”',
        'ì™€ì¹´ëª¨', 'ë‰´ìš°ì¹´', 'ì•„ë§ˆë¦¬', 'ì„¸ì´ì•„', 'ìˆ˜ì´ì•„', 'ìº í•˜ë ˆ', 'ë“œì•„ë£¨', 'ì½”ì½”ë‚˜',
        'ìš´ìœ ì¹´','íˆì¹´ë¦¬','ë…¸ì¡°ë¯¸','ë‚˜ê¸°ì‚¬','ë‰´ì¸ í‚¤','ì•„ì½”','íˆë§ˆë¦¬','ë‰´ìš”ì½”','ìš°ì´','ìŠŒ','ì²´ë¦¬ë…¸','íˆë‚˜íƒ€',
        'ìˆ˜ì¦ˆë‚˜', 'ë‰´ë£¨ë‚˜', 'ë“œì•„ì½”', 'ìˆ˜ìš°ì´', 'ìˆ˜ìš”ë¦¬'
    ];
    const priority = Object.fromEntries(priorityList.map((name, idx) => [name, idx]));
    return [...chars].sort((a, b) => (priority[a] ?? 999) - (priority[b] ?? 999));
}

function renderPagination(totalPage) {
    const paginationDiv = document.getElementById('pagination');
    paginationDiv.innerHTML = '';

    let start = Math.max(2, currentPage - 4);
    let end = Math.min(totalPage - 1, currentPage + 4);

    // í•­ìƒ 1í˜ì´ì§€ëŠ” í‘œì‹œ
    const first = document.createElement('button');
    first.className = 'page-btn' + (currentPage === 1 ? ' active' : '');
    first.innerText = '1';
    first.onclick = () => goToPage(1);
    paginationDiv.appendChild(first);

    // ì™¼ìª½ ìƒëµë¶€í˜¸
    if (start > 2) {
        const dots = document.createElement('span');
        dots.className = 'page-dots';
        dots.innerText = '...';
        paginationDiv.appendChild(dots);
    }

    for (let i = start; i <= end; i++) {
        const btn = document.createElement('button');
        btn.className = 'page-btn' + (i === currentPage ? ' active' : '');
        btn.innerText = i;
        btn.onclick = () => goToPage(i);
        paginationDiv.appendChild(btn);
    }

    // ì˜¤ë¥¸ìª½ ìƒëµë¶€í˜¸
    if (end < totalPage - 1) {
        const dots = document.createElement('span');
        dots.className = 'page-dots';
        dots.innerText = '...';
        paginationDiv.appendChild(dots);
    }

    // ë§ˆì§€ë§‰ í˜ì´ì§€ëŠ” í•­ìƒ í‘œì‹œ
    if (totalPage > 1) {
        const last = document.createElement('button');
        last.className = 'page-btn' + (currentPage === totalPage ? ' active' : '');
        last.innerText = totalPage;
        last.onclick = () => goToPage(totalPage);
        paginationDiv.appendChild(last);
    }
}

function goToPage(page) {
    currentPage = page;
    renderAccounts(currentFilteredAccounts);
    window.scrollTo({ top: document.getElementById('characters').offsetTop, behavior: 'smooth' });
}

function openAccountModal(accountNum) {
    // ê³„ì • ë°ì´í„° ì°¾ê¸°
    const acc = accounts.find(a => a.num === accountNum);
    if (!acc) return;

    // ê³„ì •ë²ˆí˜¸, ê°€ê²©, ì´ í•™ìƒ ìˆ˜ í‘œê¸°
    document.getElementById('modalAccountNum').innerText = `ê³„ì •ë²ˆí˜¸: ${accountNum}`;
    document.getElementById('modalAccountPrice').innerText = `ê°€ê²©: ${acc.price}ë§Œ`;
    document.getElementById('modalAccountCount').innerText = `ì´ í•™ìƒ ${acc.chars.length}ëª…`;

    // ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸
    const copyBtn = document.getElementById('modalCopyBtn');
    copyBtn.onclick = function() {
        const copyText = `${acc.num} (${acc.price}ë§Œ)`;
        navigator.clipboard.writeText(copyText).then(() => alert('ê³„ì •ë²ˆí˜¸ ë³µì‚¬ ì™„ë£Œ!'));
    };

    // ìºë¦­í„° ëª©ë¡ ì˜ì—­
    const charWrap = document.getElementById('modalAccountChars');
    charWrap.innerHTML = '';

    // ìºë¦­í„° ìš°ì„ ì •ë ¬(ì „ì²´), ì¤‘ë³µì œê±°
    const allChars = [...new Set(acc.chars)];
    const sortedChars = sortCharactersByPriority(allChars);

    sortedChars.forEach(name => {
        const wrapper = document.createElement('div');
        wrapper.className = 'result-character-card';

        const img = document.createElement('img');
        img.src = `/static/images/${name}.png`;
        img.style.border = `2px solid ${gradeBorderColors[getGradeByName(name)] || 'gray'}`;
        img.style.width = "48px";
        img.style.height = "48px";

        const nameDiv = document.createElement('div');
        nameDiv.className = 'character-name';
        nameDiv.innerText = name;
        nameDiv.style.fontSize = "13px";

        const featureDiv = document.createElement('div');
        featureDiv.className = 'character-feature';
        featureDiv.innerText = getFeatureByName(name);
        featureDiv.style.fontSize = "12px";

        wrapper.appendChild(img);
        wrapper.appendChild(nameDiv);
        wrapper.appendChild(featureDiv);
        charWrap.appendChild(wrapper);
    });

    document.getElementById('accountModal').style.display = 'flex';
}

function closeAccountModal() {
    document.getElementById('accountModal').style.display = 'none';
}

// 1. ìƒì„¸ê²€ìƒ‰ ë²„íŠ¼ ì´ë²¤íŠ¸
document.getElementById('detailSearchBtn').onclick = function() {
    openDetailModal();
};

function openDetailModal() {
    // 2í‹°ì–´ ì´í•˜ í‹°ì–´(2í‹°ì–´ë§Œ) í•™ìƒ í•„í„°ë§
    const tier2Names = characterData.filter(c => c.grade === "2í‹°ì–´").map(c => c.name);

    // accounts ì „ì²´ í•™ìƒ ì´ë¦„ ëª¨ìœ¼ê¸°
    let allStudentSet = new Set();
    accounts.forEach(acc => acc.chars.forEach(name => allStudentSet.add(name)));
    const allStudentArr = Array.from(allStudentSet);

    // í‹°ì–´í‘œì— ìˆëŠ” ëª¨ë“  í•™ìƒ
    const allTierStudentSet = new Set(characterData.map(c => c.name));

    // "ê¸°íƒ€" í•™ìƒ: ê³„ì •ì— ìˆëŠ”ë° í‹°ì–´í‘œì— ì—†ëŠ” í•™ìƒë§Œ ì¶”ì¶œ
    const etcNames = allStudentArr.filter(name => !allTierStudentSet.has(name));

    // ê¸°íƒ€ í•™ìƒ ì¶œë ¥
    const otherCharWrap = document.getElementById('otherCharWrap');
    otherCharWrap.innerHTML = '';
    etcNames.forEach(name => {
        otherCharWrap.appendChild(makeDetailCharCard(name));
    });

    document.getElementById('detailModal').style.display = 'flex';
}

// ìƒì„¸ê²€ìƒ‰ ìºë¦­í„° ì„ íƒ ì¹´ë“œ ìƒì„± í•¨ìˆ˜
function makeDetailCharCard(name) {
    const wrapper = document.createElement('div');
    wrapper.className = 'character-card';
    wrapper.style.width = '66px';
    wrapper.style.padding = '2px';
    wrapper.style.cursor = 'pointer';

    const img = document.createElement('img');
    img.src = `/static/images/${name}.png`;
    img.style.width = '50px';
    img.style.height = '50px';
    img.style.borderRadius = '10px';
    img.style.border = `3px solid ${gradeBorderColors[getGradeByName(name)] || '#bbb'}`;

    if (selectedChars.includes(name)) {
        wrapper.classList.add('selected');
        img.classList.add('selected');
    }

    img.onclick = function() {
        toggleCharacter(name, img, wrapper);
        // ì„ íƒ ë°˜ì˜ í›„ ìŠ¤íƒ€ì¼ ë™ê¸°í™”
        if (selectedChars.includes(name)) {
            wrapper.classList.add('selected');
            img.classList.add('selected');
        } else {
            wrapper.classList.remove('selected');
            img.classList.remove('selected');
        }
    };

    const nameDiv = document.createElement('div');
    nameDiv.className = 'character-name';
    nameDiv.innerText = name;
    nameDiv.style.fontSize = "12px";
    wrapper.appendChild(img);
    wrapper.appendChild(nameDiv);

    return wrapper;
}

function removeSelectedCharacter(name) {
    // ë°°ì—´ì—ì„œ í•´ë‹¹ ìºë¦­í„° ì œê±°
    selectedChars = selectedChars.filter(c => c !== name);

    updateSelectedInfo();
    drawCharacters(); // ìœ„ ìºë¦­í„° ì¹´ë“œ ì„ íƒ í‘œì‹œ ë™ê¸°í™”
}

// ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
function closeDetailModal() {
    document.getElementById('detailModal').style.display = 'none';
}

    
</script>

</body>
</html>